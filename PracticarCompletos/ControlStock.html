<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>MarketStock - Control de Inventario</title>
    <style>
        body { font-family: 'Trebuchet MS', sans-serif; background-color: #333; color: white; padding: 20px; }
        
        .container { display: flex; gap: 20px; }
        .panel { background: #444; padding: 20px; border-radius: 10px; flex: 1; }
        
        input { width: 95%; padding: 8px; margin: 5px 0 15px 0; border: none; border-radius: 4px; }
        button { width: 100%; padding: 10px; background: #ff9800; border: none; color: black; font-weight: bold; cursor: pointer; }
        button:hover { background: #e68900; }
        
        table { width: 100%; margin-top: 20px; border-collapse: collapse; background: #555; }
        th { background: #222; padding: 10px; }
        td { padding: 10px; border-bottom: 1px solid #666; }
        
        .alerta-stock { color: #ff5555; font-weight: bold; } /* Rojo si poco stock */
        .ok-stock { color: #55ff55; } /* Verde si todo ok */
    </style>
</head>
<body>

    <h1 style="text-align: center;">üì¶ MarketStock Inventario</h1>

    <div class="container">
        <div class="panel">
            <h3>Nuevo Producto</h3>
            <form id="formAdd">
                <label>C√≥digo Ref:</label>
                <input type="text" id="cod" required>
                <label>Nombre:</label>
                <input type="text" id="nom" required>
                <label>Precio Unitario (‚Ç¨):</label>
                <input type="number" id="pre" step="0.01" required>
                <label>Stock Inicial:</label>
                <input type="number" id="stk" required>
                <button type="submit">A√±adir al Almac√©n</button>
            </form>
        </div>

        <div class="panel">
            <h3>Actualizar Stock</h3>
            <form id="formMod">
                <label>C√≥digo Ref a buscar:</label>
                <input type="text" id="modCod" required>
                <label>Nuevo Stock:</label>
                <input type="number" id="modStk" required>
                <button type="submit" style="background-color: #00bcd4;">Actualizar Cantidad</button>
            </form>
            <br>
            <button onclick="calcularValorTotal()" style="background-color: #9c27b0; color: white;">
                Calcular Valor del Almac√©n
            </button>
        </div>
    </div>

    <h2 id="tituloTotal">Valor Total Inventario: 0.00 ‚Ç¨</h2>

    <table>
        <thead>
            <tr>
                <th>C√≥d</th>
                <th>Producto</th>
                <th>Precio</th>
                <th>Stock</th>
                <th>Valor (‚Ç¨)</th>
                <th>Estado</th>
            </tr>
        </thead>
        <tbody id="tablaCuerpo"></tbody>
    </table>

    <script>
        // 1. CLASE
        class Producto {
            constructor(codigo, nombre, precio, stock) {
                this.codigo = codigo;
                this.nombre = nombre;
                this.precio = parseFloat(precio);
                this.stock = parseInt(stock);
            }
        }

        // 2. ARRAY
        const inventario = [];

        // 3. FUNCIONES
        function pintarInventario() {
            const tbody = document.getElementById("tablaCuerpo");
            tbody.innerHTML = "";

            inventario.forEach(prod => {
                let valor = prod.precio * prod.stock;
                
                // L√≥gica Visual (CSS condicional)
                let estadoClase = prod.stock < 5 ? "alerta-stock" : "ok-stock";
                let textoEstado = prod.stock < 5 ? "‚ö†Ô∏è BAJO M√çNIMOS" : "‚úÖ Correcto";

                tbody.innerHTML += `
                    <tr>
                        <td>${prod.codigo}</td>
                        <td>${prod.nombre}</td>
                        <td>${prod.precio} ‚Ç¨</td>
                        <td>${prod.stock}</td>
                        <td>${valor.toFixed(2)} ‚Ç¨</td>
                        <td class="${estadoClase}">${textoEstado}</td>
                    </tr>
                `;
            });
        }

        function calcularValorTotal() {
            let total = 0;
            inventario.forEach(p => {
                total += (p.precio * p.stock);
            });
            document.getElementById("tituloTotal").innerText = 
                `Valor Total Inventario: ${total.toFixed(2)} ‚Ç¨`;
        }

        // 4. EVENTOS DE FORMULARIO
        
        // A) A√±adir
        document.getElementById("formAdd").addEventListener("submit", function(e) {
            e.preventDefault();
            let cod = document.getElementById("cod").value;
            
            // Comprobamos si existe (find)
            if(inventario.find(p => p.codigo === cod)){
                alert("Error: Ese c√≥digo de producto ya existe.");
                return;
            }

            let nom = document.getElementById("nom").value;
            let pre = document.getElementById("pre").value;
            let stk = document.getElementById("stk").value;

            inventario.push(new Producto(cod, nom, pre, stk));
            pintarInventario();
            this.reset();
        });

        // B) Modificar (Clave en el examen anterior)
        document.getElementById("formMod").addEventListener("submit", function(e) {
            e.preventDefault();
            let busqueda = document.getElementById("modCod").value;
            let nuevoStock = parseInt(document.getElementById("modStk").value);

            // Buscar objeto dentro del array
            let productoEncontrado = inventario.find(p => p.codigo === busqueda);

            if (productoEncontrado) {
                // Modificamos la propiedad del objeto encontrado
                productoEncontrado.stock = nuevoStock;
                alert(`Stock de ${productoEncontrado.nombre} actualizado a ${nuevoStock}`);
                pintarInventario(); // Repintar tabla
            } else {
                alert("Error: Producto no encontrado con ese c√≥digo.");
            }
            this.reset();
        });

    </script>
</body>
</html>