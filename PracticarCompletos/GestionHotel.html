<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>HotelManager - Con Persistencia</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f4f4f4; }
        .caja { background: white; padding: 15px; border: 1px solid #ddd; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; background: white; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #007bff; color: white; }
        button { cursor: pointer; padding: 5px 10px; }
        .btn-borrar { background-color: #dc3545; color: white; border: none; }
    </style>
</head>
<body>

<h1>HotelManager (Con LocalStorage)</h1>

<div class="caja">
    <h3>Nueva Habitación</h3>
    <form id="formHotel">
        <input type="text" id="numero" placeholder="Nº Habitación" required>
        <input type="number" id="precio" placeholder="Precio" required>
        <button type="submit">Guardar</button>
    </form>
</div>

<h3>Listado (Se guarda aunque recargues)</h3>
<table id="tablaHabitaciones">
    <thead>
        <tr>
            <th>Habitación</th>
            <th>Precio</th>
            <th>Acción</th>
        </tr>
    </thead>
    <tbody id="cuerpoTabla"></tbody>
</table>

<script>
    // 1. CARGAR DATOS (Concepto clave Unidad 4 - Pag 21)
    // Intentamos leer de LocalStorage. Si no hay nada (null), iniciamos array vacío.
    // Usamos JSON.parse para convertir el texto guardado en un Array real.
    let habitaciones = JSON.parse(localStorage.getItem("misHabitaciones")) || [];

    // Llamamos a pintar nada más abrir la página para ver lo guardado
    pintarTabla();

    // 2. GUARDAR DATOS (Función auxiliar)
    function guardarEnLocal() {
        // Usamos JSON.stringify para convertir el Array a Texto plano
        localStorage.setItem("misHabitaciones", JSON.stringify(habitaciones));
    }

    // 3. EVENTO AÑADIR (Unidad 4 - Eventos - Pag 15)
    document.getElementById('formHotel').addEventListener('submit', function(e) {
        e.preventDefault(); // Evita recarga (Pag 19 - event)
        
        let num = document.getElementById('numero').value;
        let pre = document.getElementById('precio').value;

        // Añadimos al array
        habitaciones.push({ numero: num, precio: pre });
        
        // ¡IMPORTANTE! Guardamos y Repintamos
        guardarEnLocal();
        pintarTabla();
        
        this.reset();
    });

    // 4. PINTAR DOM (Unidad 4 - Modificación Dinámica - Pag 11-12)
    function pintarTabla() {
        let tbody = document.getElementById('cuerpoTabla');
        tbody.innerHTML = ""; // Limpiamos contenido previo (Pag 12)

        habitaciones.forEach((hab, index) => {
            // Creamos fila (TR)
            let fila = document.createElement("tr");

            // Rellenamos HTML interno
            fila.innerHTML = `
                <td>${hab.numero}</td>
                <td>${hab.precio} €</td>
                <td>
                    <button class="btn-borrar">Eliminar</button>
                </td>
            `;

            // DELEGACIÓN/ASIGNACIÓN DIRECTA (Unidad 4 - Pag 18)
            // Asignamos el evento click al botón borrar justo al crearlo
            let btnBorrar = fila.querySelector(".btn-borrar");
            btnBorrar.addEventListener("click", function() {
                borrarHabitacion(index);
            });

            // Añadir al DOM (appendChild - Pag 5)
            tbody.appendChild(fila);
        });
    }

    // 5. BORRAR (Unidad 4 - Eliminar elementos - Pag 12)
    function borrarHabitacion(indice) {
        if(confirm("¿Borrar habitación?")) {
            // 1. Borrar del Array
            habitaciones.splice(indice, 1);
            
            // 2. Actualizar LocalStorage (para que no vuelva a salir al recargar)
            guardarEnLocal();
            
            // 3. Actualizar vista
            pintarTabla();
        }
    }
</script>

</body>
</html>