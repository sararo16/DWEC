<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>TechSolutions - Gestión de Nóminas</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f0f2f5; padding: 20px; }
        h1, h2 { color: #333; }
        
        /* Cajas de formulario */
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
        
        label { display: block; margin-top: 10px; font-weight: bold; }
        input, button { padding: 8px; margin-top: 5px; width: 100%; box-sizing: border-box; }
        
        button { background-color: #007bff; color: white; border: none; cursor: pointer; margin-top: 15px; font-size: 16px; }
        button:hover { background-color: #0056b3; }
        
        /* Estilos de Tabla */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; background: white; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background-color: #343a40; color: white; }
        
        .btn-delete { background-color: #dc3545; width: auto; padding: 5px 10px; margin: 0; }
        .high-salary { color: green; font-weight: bold; }
    </style>
</head>
<body>

    <h1>TechSolutions HR</h1>

    <div class="card">
        <h2>Alta de Empleado</h2>
        <form id="formAlta">
            <label>DNI:</label>
            <input type="text" id="dni" required placeholder="Ej: 12345678A">
            
            <label>Nombre:</label>
            <input type="text" id="nombre" required>
            
            <label>Sueldo Base (€):</label>
            <input type="number" id="base" required step="100">
            
            <label>Años Antigüedad:</label>
            <input type="number" id="antiguedad" required value="0">
            
            <button type="submit">Contratar Empleado</button>
        </form>
    </div>

    <button onclick="calcularNominas()" style="background-color: #28a745; margin-bottom: 20px;">
        Calcular Nóminas y Filtrar
    </button>

    <h2>Plantilla Completa</h2>
    <table id="tablaEmpleados">
        <thead>
            <tr>
                <th>DNI</th>
                <th>Nombre</th>
                <th>Base</th>
                <th>Antigüedad</th>
                <th>Sueldo Final</th>
                <th>Categoría</th>
                <th>Acción</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <h2>Empleados Senior (> 2000€)</h2>
    <table id="tablaSeniors">
        <thead>
            <tr>
                <th>Nombre</th>
                <th>Sueldo Final</th>
                <th>Retención IRPF (15%)</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        // 1. CLASES
        class Empleado {
            constructor(dni, nombre, base, antiguedad) {
                this.dni = dni;
                this.nombre = nombre;
                this.base = parseFloat(base);
                this.antiguedad = parseInt(antiguedad);
            }
        }

        // 2. ARRAYS
        const plantilla = [];
        const empleadosVIP = []; // Array auxiliar para la segunda tabla

        // 3. FUNCIONES
        function anadirEmpleado(dni, nombre, base, antiguedad) {
            // Validación básica
            if(base < 0 || antiguedad < 0) {
                alert("Datos numéricos incorrectos");
                return;
            }
            
            // Validación de duplicados (Extra para examen)
            let existe = plantilla.find(e => e.dni === dni);
            if(existe) {
                alert("Error: Ya existe un empleado con ese DNI.");
                return;
            }

            let nuevo = new Empleado(dni, nombre, base, antiguedad);
            plantilla.push(nuevo);
            mostrarTabla();
        }

        function mostrarTabla() {
            const tbody = document.querySelector("#tablaEmpleados tbody");
            tbody.innerHTML = ""; // Limpiar

            plantilla.forEach((emp, index) => {
                // Cálculo simple solo para visualizar, el cálculo real fuerte se hace en el botón verde
                let plusAntiguedad = emp.antiguedad * 50;
                let final = emp.base + plusAntiguedad;
                
                tbody.innerHTML += `
                    <tr>
                        <td>${emp.dni}</td>
                        <td>${emp.nombre}</td>
                        <td>${emp.base} €</td>
                        <td>${emp.antiguedad} años</td>
                        <td>${final} €</td>
                        <td>${final > 2000 ? "Senior" : "Junior"}</td>
                        <td>
                            <button class="btn-delete" onclick="eliminarEmpleado(${index})">X</button>
                        </td>
                    </tr>
                `;
            });
        }

        function eliminarEmpleado(index) {
            if(confirm("¿Despedir a este empleado?")) {
                plantilla.splice(index, 1);
                mostrarTabla();
            }
        }

        function calcularNominas() {
            // Limpiamos arrays y tablas secundarias
            empleadosVIP.length = 0; 
            const tbodyVIP = document.querySelector("#tablaSeniors tbody");
            tbodyVIP.innerHTML = "";

            plantilla.forEach(emp => {
                let sueldoFinal = emp.base + (emp.antiguedad * 50);

                // Lógica de filtrado
                if (sueldoFinal > 2000) {
                    let irpf = sueldoFinal * 0.15;
                    // Guardamos en el objeto (o en un array secundario)
                    empleadosVIP.push({ nombre: emp.nombre, final: sueldoFinal, irpf: irpf });
                    
                    // Pintamos en la segunda tabla
                    tbodyVIP.innerHTML += `
                        <tr>
                            <td>${emp.nombre}</td>
                            <td class="high-salary">${sueldoFinal} €</td>
                            <td>${irpf.toFixed(2)} €</td>
                        </tr>
                    `;
                }
            });

            if(empleadosVIP.length === 0) {
                tbodyVIP.innerHTML = "<tr><td colspan='3'>No hay empleados Senior</td></tr>";
            }
            
            // Refrescamos la principal para asegurar que los datos estén al día
            mostrarTabla(); 
        }

        // 4. EVENTOS (Sin jQuery, Vanilla JS moderno)
        document.getElementById("formAlta").addEventListener("submit", function(e) {
            e.preventDefault();
            
            let d = document.getElementById("dni").value;
            let n = document.getElementById("nombre").value;
            let b = document.getElementById("base").value;
            let a = document.getElementById("antiguedad").value;

            anadirEmpleado(d, n, b, a);
            
            this.reset(); // Limpiar formulario
        });

    </script>
</body>
</html>