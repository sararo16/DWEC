<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Examen: Gesti√≥n de Tienda</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f0f0f0; }
        
        /* Cajas de estilo */
        .panel { background: white; padding: 20px; border-radius: 5px; margin-bottom: 20px; border: 1px solid #ccc; }
        
        /* Estilos para la tabla */
        table { width: 100%; border-collapse: collapse; background: white; }
        th, td { border: 1px solid #999; padding: 8px; text-align: left; }
        th { background-color: #333; color: white; }
        
        /* CLASES DIN√ÅMICAS (Esto punt√∫a en la Unidad 4) */
        .stock-bajo { color: red; font-weight: bold; background-color: #ffeeee; }
        .stock-bien { color: green; }

        /* Botones */
        input, button { padding: 8px; margin: 5px 0; width: 100%; box-sizing: border-box; }
        .btn-borrar { background-color: #d9534f; color: white; border: none; cursor: pointer; width: auto; }
        .btn-add { background-color: #0275d8; color: white; border: none; cursor: pointer; }
    </style>
</head>
<body>

    <h1>üì¶ Gesti√≥n de Inventario (Tienda)</h1>

    <div class="panel">
        <h3>Nuevo Producto</h3>
        <form id="formularioProducto">
            <label>Nombre del Producto:</label>
            <input type="text" id="nombre" placeholder="Ej: Rat√≥n USB" required>
            
            <label>Precio (‚Ç¨):</label>
            <input type="number" id="precio" placeholder="Ej: 15.50" step="0.01" required>
            
            <label>Unidades en Stock:</label>
            <input type="number" id="stock" placeholder="Ej: 10" required>
            
            <button type="submit" class="btn-add">A√±adir Producto</button>
        </form>
    </div>

    <div class="panel">
        <h3>Listado de Productos</h3>
        <table>
            <thead>
                <tr>
                    <th>Producto</th>
                    <th>Precio</th>
                    <th>Stock</th>
                    <th>Valor Total</th>
                    <th>Acci√≥n</th>
                </tr>
            </thead>
            <tbody id="cuerpoTabla">
                </tbody>
        </table>
        <h3>Valor total del almac√©n: <span id="totalAlmacen">0.00</span> ‚Ç¨</h3>
    </div>

    <script>
        // --- PARTE 1: DEFINICI√ìN DE CLASE (El molde) ---
        class Producto {
            constructor(nombre, precio, stock) {
                this.nombre = nombre;
                this.precio = parseFloat(precio); // Importante: convertir a n√∫mero
                this.stock = parseInt(stock);     // Importante: convertir a entero
            }
        }

        // --- PARTE 2: CARGAR DATOS (LOCALSTORAGE) ---
        // Al arrancar, miramos si hay datos guardados. Si no, array vac√≠o.
        [cite_start]// [cite: 526] - LocalStorage
        let inventario = JSON.parse(localStorage.getItem("datosTienda")) || [];

        // --- PARTE 3: FUNCI√ìN PRINCIPAL (PINTAR) ---
        function actualizarPantalla() {
            let tbody = document.getElementById("cuerpoTabla");
            tbody.innerHTML = ""; [cite_start]// Limpiamos la tabla antes de repintar [cite: 297]
            
            let sumaTotalDinero = 0; // Acumulador para la estad√≠stica

            // Recorremos el array
            inventario.forEach((prod, indice) => {
                
                // C√°lculo: Precio * Stock
                let valorProducto = prod.precio * prod.stock;
                sumaTotalDinero += valorProducto;

                // L√≥gica Visual: Si hay menos de 5 unidades, es "stock-bajo"
                let claseCSS = "";
                let textoEstado = "";
                
                if(prod.stock < 5) {
                    claseCSS = "stock-bajo"; // Clase definida arriba en CSS
                    textoEstado = "¬°Pocas unidades!";
                } else {
                    claseCSS = "stock-bien";
                }

                // Generamos el HTML de la fila
                // F√≠jate en el bot√≥n Eliminar: llama a borrarProducto con el √≠ndice
                let fila = `
                    <tr class="${claseCSS}">
                        <td>${prod.nombre} <br> <small>${textoEstado}</small></td>
                        <td>${prod.precio.toFixed(2)} ‚Ç¨</td>
                        <td>${prod.stock} uds.</td>
                        <td>${valorProducto.toFixed(2)} ‚Ç¨</td>
                        <td>
                            <button class="btn-borrar" onclick="borrarProducto(${indice})">Eliminar</button>
                        </td>
                    </tr>
                `;
                
                tbody.innerHTML += fila; [cite_start]// A√±adimos la fila a la tabla [cite: 428]
            });

            // Actualizamos el total de abajo
            document.getElementById("totalAlmacen").innerText = sumaTotalDinero.toFixed(2);
        }

        // --- PARTE 4: GUARDAR DATOS ---
        function guardar() {
            // Convertimos el array a texto y lo guardamos en el navegador
            localStorage.setItem("datosTienda", JSON.stringify(inventario));
            actualizarPantalla();
        }

        // --- PARTE 5: EVENTOS (A√ëADIR Y BORRAR) ---

        // A) A√±adir (Submit del formulario)
        document.getElementById("formularioProducto").addEventListener("submit", function(e) {
            e.preventDefault(); // Evita que la p√°gina se recargue sola
            
            // 1. Capturar valores
            let n = document.getElementById("nombre").value;
            let p = document.getElementById("precio").value;
            let s = document.getElementById("stock").value;

            // 2. Crear objeto
            let nuevoProd = new Producto(n, p, s);

            // 3. Meter en array y guardar
            inventario.push(nuevoProd);
            guardar();

            // 4. Limpiar formulario
            this.reset();
        });

        // B) Borrar (Funci√≥n llamada desde el bot√≥n HTML)
        function borrarProducto(posicion) {
            if(confirm("¬øSeguro que quieres eliminar este producto?")) {
                // Elimina 1 elemento en la posici√≥n indicada
                inventario.splice(posicion, 1); [cite_start]// [cite: 311] - Concepto de eliminar
                guardar();
            }
        }

        // --- ARRANQUE ---
        // Llamamos a la funci√≥n al principio por si hab√≠a datos guardados de antes
        actualizarPantalla();

    </script>
</body>
</html>